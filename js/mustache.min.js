/* mustache.js - Logic-less {{mustache}} templates with JavaScript */
!function(a,b){if("object"==typeof exports&&exports)b(exports);else{var c={};b(c),"function"==typeof define&&define.amd?define(c):a.Mustache=c}}(this,function(a){function i(a,b){return h.call(a,b)}function j(a){return!i(d,a)}function m(a){return"function"==typeof a}function n(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function p(a){return String(a).replace(/[&<>"'\/]/g,function(a){return o[a]})}function q(a){this.string=a,this.tail=a,this.pos=0}function r(a,b){this.view=null==a?{}:a,this.parent=b,this._cache={".":this.view}}function s(){this.clearCache()}function t(b,c,d,e){function g(a){return c.render(a,d)}var h,i,j,k,n,o,p,q,f="";for(k=0,n=b.length;n>k;++k)switch(h=b[k],i=h[1],h[0]){case"#":if(j=d.lookup(i),"object"==typeof j||"string"==typeof j)if(l(j))for(o=0,p=j.length;p>o;++o)f+=t(h[4],c,d.push(j[o]),e);else j&&(f+=t(h[4],c,d.push(j),e));else m(j)?(q=null==e?null:e.slice(h[3],h[5]),j=j.call(d.view,q,g),null!=j&&(f+=j)):j&&(f+=t(h[4],c,d,e));break;case"^":j=d.lookup(i),(!j||l(j)&&0===j.length)&&(f+=t(h[4],c,d,e));break;case">":j=c.getPartial(i),m(j)&&(f+=j(d));break;case"&":j=d.lookup(i),null!=j&&(f+=j);break;case"name":j=d.lookup(i),null!=j&&(f+=a.escape(j));break;case"text":f+=i}return f}function u(a){var e,f,g,h,b=[],c=b,d=[];for(f=0,g=a.length;g>f;++f)switch(e=a[f],e[0]){case"#":case"^":d.push(e),c.push(e),c=e[4]=[];break;case"/":h=d.pop(),h[5]=e[2],c=d.length>0?d[d.length-1][4]:b;break;default:c.push(e)}return b}function v(a){var c,d,e,f,b=[];for(e=0,f=a.length;f>e;++e)c=a[e],c&&("text"===c[0]&&d&&"text"===d[0]?(d[1]+=c[1],d[3]=c[3]):(d=c,b.push(c)));return b}function w(a){return[new RegExp(n(a[0])+"\\s*"),new RegExp("\\s*"+n(a[1]))]}function x(d,h){function s(){if(p&&!r)for(;o.length;)delete m[o.pop()];else o=[];p=!1,r=!1}var i,k,l,m,o,p,r,t,x,y,z,A,B,C,D;if(d=d||"",h=h||a.tags,"string"==typeof h&&(h=h.split(c)),2!==h.length)throw new Error("Invalid tags: "+h.join(", "));for(i=w(h),k=new q(d),l=[],m=[],o=[],p=!1,r=!1;!k.eos();){if(t=k.pos,y=k.scanUntil(i[0]))for(C=0,D=y.length;D>C;++C)z=y.charAt(C),j(z)?o.push(m.length):r=!0,m.push(["text",z,t,t+1]),t+=1,"\n"==z&&s();if(!k.scan(i[0]))break;if(p=!0,x=k.scan(g)||"name",k.scan(b),"="===x?(y=k.scanUntil(e),k.scan(e),k.scanUntil(i[1])):"{"===x?(y=k.scanUntil(new RegExp("\\s*"+n("}"+h[1]))),k.scan(f),k.scanUntil(i[1]),x="&"):y=k.scanUntil(i[1]),!k.scan(i[1]))throw new Error("Unclosed tag at "+k.pos);if(A=[x,y,t,k.pos],m.push(A),"#"===x||"^"===x)l.push(A);else if("/"===x){if(B=l.pop(),!B)throw new Error('Unopened section "'+y+'" at '+t);if(B[1]!==y)throw new Error('Unclosed section "'+B[1]+'" at '+t)}else if("name"===x||"{"===x||"&"===x)r=!0;else if("="===x){if(h=y.split(c),2!==h.length)throw new Error("Invalid tags at "+t+": "+h.join(", "));i=w(h)}}if(B=l.pop())throw new Error('Unclosed section "'+B[1]+'" at '+k.pos);return u(v(m))}var y,b=/\s*/,c=/\s+/,d=/\S/,e=/\s*=/,f=/\s*\}/,g=/#|\^|\/|>|\{|&|=|!/,h=RegExp.prototype.test,k=Object.prototype.toString,l=Array.isArray||function(a){return"[object Array]"===k.call(a)},o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};q.prototype.eos=function(){return""===this.tail},q.prototype.scan=function(a){var c,b=this.tail.match(a);return b&&0===b.index?(c=b[0],this.tail=this.tail.substring(c.length),this.pos+=c.length,c):""},q.prototype.scanUntil=function(a){var c,b=this.tail.search(a);switch(b){case-1:c=this.tail,this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,b),this.tail=this.tail.substring(b)}return this.pos+=c.length,c},r.make=function(a){return a instanceof r?a:new r(a)},r.prototype.push=function(a){return new r(a,this)},r.prototype.lookup=function(a){var b,c,d,e;if(a in this._cache)b=this._cache[a];else{for(c=this;c;){if(a.indexOf(".")>0)for(b=c.view,d=a.split("."),e=0;null!=b&&e<d.length;)b=b[d[e++]];else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return m(b)&&(b=b.call(this.view)),b},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(b,c){var e,d=this._cache[b];return d||(e=a.parse(b,c),d=this._cache[b]=this.compileTokens(e,b)),d},s.prototype.compilePartial=function(a,b,c){var d=this.compile(b,c);return this._partialCache[a]=d,d},s.prototype.getPartial=function(a){return a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a)),this._partialCache[a]},s.prototype.compileTokens=function(a,b){var c=this;return function(d,e){if(e)if(m(e))c._loadPartial=e;else for(var f in e)c.compilePartial(f,e[f]);return t(a,c,r.make(d),b)}},s.prototype.render=function(a,b,c){return this.compile(a)(b,c)},a.name="mustache.js",a.version="0.7.3",a.tags=["{{","}}"],a.Scanner=q,a.Context=r,a.Writer=s,a.parse=x,a.escape=p,y=new s,a.clearCache=function(){return y.clearCache()},a.compile=function(a,b){return y.compile(a,b)},a.compilePartial=function(a,b,c){return y.compilePartial(a,b,c)},a.compileTokens=function(a,b){return y.compileTokens(a,b)},a.render=function(a,b,c){return y.render(a,b,c)},a.to_html=function(b,c,d,e){var f=a.render(b,c,d);return m(e)?(e(f),void 0):f}});